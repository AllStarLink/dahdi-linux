From: Tzafrir Cohen <tzafrir@debian.org>
Subject: 5.18: Wrappers for pci_alloc_consistent et all

Index: dahdi-linux/include/dahdi/kernel.h
===================================================================
--- dahdi-linux.orig/include/dahdi/kernel.h	2022-06-18 15:47:45.844555157 +0300
+++ dahdi-linux/include/dahdi/kernel.h	2022-06-18 16:55:02.216499341 +0300
@@ -1404,6 +1404,21 @@
 /*! Maximum audio mask */
 #define DAHDI_FORMAT_AUDIO_MASK	((1 << 16) - 1)
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5, 18, 0)
+#define pci_alloc_consistent(hwdev, size, dma_handle) \
+	dma_alloc_coherent(&(hwdev)->dev, size, dma_handle, GFP_ATOMIC)
+#define pci_free_consistent(hwdev, size, vaddr, dma_handle) \
+	dma_free_coherent(&(hwdev)->dev, size, vaddr, dma_handle)
+#define pci_map_single(hwdev, ptr, size, direction) \
+	dma_map_single(&(hwdev)->dev, ptr, size, \
+		(enum dma_data_direction)(direction))
+#define pci_unmap_single(hwdev, dma_addr, size, direction) \
+	dma_unmap_single(&(hwdev)->dev, dma_addr, size, \
+		(enum dma_data_direction)(direction))
+#define pci_set_dma_mask(hwdev, mask) \
+	dma_set_mask(&(hwdev)->dev, mask)
+#endif
+
 #if LINUX_VERSION_CODE < KERNEL_VERSION(4, 15, 0)
 
 #ifndef TIMER_DATA_TYPE
